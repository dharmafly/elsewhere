<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>Elsewhere</title>
    <style>
    .unverified {
      color:#CE0000;
    }
    .verified {
      color:#00C900;
    }
    #url {
      width:250px;
    }
    #prog {
      display:none;
    }
    </style>
  </head>
  <body>
    <h1>Elsewhere</h1>
    <p>You can against query the server directly with default settings like so:</p>
    <pre>http://localhost:8888/twitter.com/premasagar</pre>
    <p>The result will be returned as JSON.</p>
    <p>Alternatively, just enter a url below and hit enter to get a nice list of links.</p>
    <ol id="list"></ol>
    <input type="text" id="url" value="lanyrd.com/profile/chrisnewtn" />
    <input type="checkbox" id="strict" checked />
    <label>strict</label>
    <progress id="prog"></progress>
    <script>

function getGraph (e) {
  var url    = document.getElementById('url'),
      strict = document.getElementById('strict'),
      prog   = document.getElementById('prog'),
      strict = strict.checked ? '&strict=true' : '&strict=false',
      url    = location.href + '?url=' + encodeURIComponent(url.value) + strict,
      xhr    = new XMLHttpRequest();

  prog.style.display = "block";

  xhr.open("GET", url, true);
  xhr.onreadystatechange = function(event){
    if (xhr.readyState === 4) {
      if (xhr.status === 200) {
        prog.style.display = "none";
        renderGraph(JSON.parse(xhr.responseText).results);
      } else { // fail
        console.log(xhr.statusText);
      }
    }
  };
  xhr.send(null);
}

function renderGraph (links) {
  var listElem = document.getElementById('list'),
      listHTML = "";

  links.forEach(function (link) {
    if (link === null) return;
    listHTML += '<li><a target="_blank" title="' + 
    link.outboundLinks.verified.join("\n") + 
    link.outboundLinks.unverified.join("\n") + '"';
    listHTML += ' href="view-source:' + link.url + '">';
    listHTML += '<img src="' + link.favicon + '" width="16px" height="16px" />';
    listHTML += (link.title || link.url) + '</a>';

    if (link.verified === undefined) {
      listHTML += '</li>';
    } else {
      listHTML += ' - <span class="' + (link.verified 
        ? 'verified">verified' 
        : 'unverified">unverified' ) + '</span></li>';
    }

    
  });

  listElem.innerHTML = listHTML;
}

document.getElementById('url').onkeydown = function (e) {
  if (e.keyCode === 13) getGraph();
}

    </script>
  </body>
</html>